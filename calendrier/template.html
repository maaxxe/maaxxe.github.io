<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <title>Mon Calendrier Interactif</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            background: #f4f7f6;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .header {
            background: white;
            padding: 15px 25px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
        }

        select,
        button {
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #ddd;
            cursor: pointer;
            font-size: 16px;
        }

        button {
            background: #333;
            color: white;
            min-width: 40px;
            font-weight: bold;
        }

        button:hover {
            background: #555;
        }

        #calendar-container {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            width: 95%;
            max-width: 1100px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
        }

        th {
            background: #f8f9fa;
            padding: 12px;
            border: 1px solid #eee;
            color: #666;
            text-transform: uppercase;
            font-size: 12px;
        }

        td {
            border: 1px solid #eee;
            height: 110px;
            vertical-align: top;
            padding: 8px;
            transition: 0.3s;
        }

        .date-num {
            font-weight: bold;
            margin-bottom: 8px;
            color: #444;
        }

        .event {
            font-size: 11px;
            padding: 4px 8px;
            margin-bottom: 4px;
            border-radius: 4px;
            border-left: 4px solid rgba(0, 0, 0, 0.1);
            font-weight: 500;
        }

        .today {
            background: #fffde7 !important;
            border: 2px solid #ffd600 !important;
        }

        h2 {
            margin: 0;
            color: #222;
            min-width: 200px;
            text-align: center;
        }
    </style>
</head>

<body>

    <div class="header">
        <button onclick="changeYear(-1)">«</button>
        <select id="monthSelect" onchange="renderCalendar()"></select>
        <select id="yearSelect" onchange="renderCalendar()"></select>
        <button onclick="changeYear(1)">»</button>
    </div>

    <div id="calendar-container">
        <h2 id="monthTitle"></h2>
        <table>
            <thead>
                <tr>
                    <th>Lun</th>
                    <th>Mar</th>
                    <th>Mer</th>
                    <th>Jeu</th>
                    <th>Ven</th>
                    <th>Sam</th>
                    <th>Dim</th>
                </tr>
            </thead>
            <tbody id="calendarBody"></tbody>
        </table>
    </div>

    <script>
        const evenements = {{ donnees_evenements }} || {};
        const months = ["Janvier", "Février", "Mars", "Avril", "Mai", "Juin", "Juillet", "Août", "Septembre", "Octobre", "Novembre", "Décembre"];

        const monthSelect = document.getElementById('monthSelect');
        const yearSelect = document.getElementById('yearSelect');

        // Remplir les sélecteurs
        months.forEach((m, i) => monthSelect.add(new Option(m, i)));
        for (let i = 2024; i <= 2030; i++) yearSelect.add(new Option(i, i));

        // Date par défaut (Aujourd'hui)
        let d = new Date();
        monthSelect.value = d.getMonth();
        yearSelect.value = d.getFullYear();

        function changeYear(step) {
            yearSelect.value = parseInt(yearSelect.value) + step;
            renderCalendar();
        }

        function renderCalendar() {
            const month = parseInt(monthSelect.value);
            const year = parseInt(yearSelect.value);
            const body = document.getElementById('calendarBody');
            const firstDay = (new Date(year, month, 1).getDay() + 6) % 7;
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            body.innerHTML = '';
            document.getElementById('monthTitle').innerText = months[month] + " " + year;

            let date = 1;
            for (let i = 0; i < 6; i++) {
                let row = document.createElement('tr');
                for (let j = 0; j < 7; j++) {
                    let cell = document.createElement('td');
                    if (i === 0 && j < firstDay || date > daysInMonth) {
                        cell.innerHTML = "";
                    } else {
                        let dateKey = String(date).padStart(2, '0') + "/" + String(month + 1).padStart(2, '0') + "/" + year;
                        if (date === d.getDate() && month === d.getMonth() && year === d.getFullYear()) cell.className = 'today';

                        let html = `<div class="date-num">${date}</div>`;
                        if (evenements[dateKey]) {
                            evenements[dateKey].forEach(ev => {
                                html += `<div class="event" style="background-color:${ev.couleur}">${ev.texte}</div>`;
                            });
                        }
                        cell.innerHTML = html;
                        date++;
                    }
                    row.appendChild(cell);
                }
                body.appendChild(row);
                if (date > daysInMonth) break;
            }
        }
        renderCalendar();
    </script>
</body>

</html>