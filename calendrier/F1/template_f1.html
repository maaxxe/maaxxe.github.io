<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <title>F1 2026 - Live Calendar</title>
    <style>
        :root {
            --f1-red: #e10600;
            --f1-dark: #15151e;
            --f1-carbon: #252525;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f4f4f4;
            margin: 0;
            padding: 20px;
        }

        .header {
            background: var(--f1-dark);
            color: white;
            padding: 20px;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 5px solid var(--f1-red);
        }

        select,
        button {
            padding: 10px;
            border-radius: 4px;
            border: none;
            font-weight: bold;
            cursor: pointer;
        }

        .calendar-grid {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
        }

        th {
            background: var(--f1-carbon);
            color: white;
            padding: 15px;
            border: 1px solid #333;
            text-transform: uppercase;
            font-size: 12px;
            letter-spacing: 1px;
        }

        td {
            border: 1px solid #ddd;
            height: 160px;
            vertical-align: top;
            padding: 8px;
            transition: 0.2s;
            position: relative;
        }

        td:hover {
            background: #f9f9f9;
        }

        .date-num {
            font-weight: 900;
            font-size: 1.1em;
            color: #bbb;
            margin-bottom: 5px;
        }

        .event {
            font-size: 10px;
            padding: 5px;
            margin-top: 4px;
            border-radius: 4px;
            background: var(--f1-red);
            color: white;
            border-left: 4px solid black;
            cursor: pointer;
            transition: transform 0.1s;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }

        .event:hover {
            transform: scale(1.03);
            filter: brightness(1.2);
        }

        #modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 0;
            border-radius: 12px;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.6);
            z-index: 1000;
            width: 350px;
            overflow: hidden;
        }

        .modal-header {
            background: var(--f1-red);
            color: white;
            padding: 15px;
            font-weight: bold;
            font-size: 1.2em;
        }

        .modal-body {
            padding: 20px;
            line-height: 1.6;
            color: #333;
        }

        #overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 999;
            backdrop-filter: blur(3px);
        }
    </style>
</head>

<body>

    <div id="overlay" onclick="closeModal()"></div>
    <div id="modal">
        <div class="modal-header" id="modalTitle"></div>
        <div class="modal-body" id="modalBody"></div>
        <button onclick="closeModal()"
            style="background: var(--f1-dark); color: white; width: 100%; border-radius: 0; padding: 15px;">QUITTER</button>
    </div>

    <div class="header">
        <div>
            <button onclick="changeMonth(-1)">«</button>
            <span id="currentDateLabel" style="margin: 0 15px; font-size: 1.4em; font-weight: bold;"></span>
            <button onclick="changeMonth(1)">»</button>
        </div>
        <div>
            <label>TIMEZONE : </label>
            <select id="utcSelect" onchange="renderCalendar()">
                <option value="-5" selected>Montréal (UTC-5)</option>
                <option value="0">Greenwich (UTC 0)</option>
                <option value="1">Paris (UTC+1)</option>
                <option value="8">Singapour (UTC+8)</option>
            </select>
        </div>
    </div>

    <div class="calendar-grid">
        <table>
            <thead>
                <tr>
                    <th>Lun</th>
                    <th>Mar</th>
                    <th>Mer</th>
                    <th>Jeu</th>
                    <th>Ven</th>
                    <th>Sam</th>
                    <th>Dim</th>
                </tr>
            </thead>
            <tbody id="calendarBody"></tbody>
        </table>
    </div>

    <script>
        // Python remplacera ce marqueur par le JSON
        const data = __JSON_DATA__;

        let now = new Date();
        let currentMonth = now.getMonth();
        let currentYear = 2026;

        function changeMonth(step) {
            currentMonth += step;
            if (currentMonth > 11) { currentMonth = 0; currentYear++; }
            if (currentMonth < 0) { currentMonth = 11; currentYear--; }
            renderCalendar();
        }

        function showInfo(gp, titre, heure, info) {
            document.getElementById('modalTitle').innerText = titre;
            document.getElementById('modalBody').innerHTML = " <b>Heure Locale :</b> " + heure + "<br><br>" + info;
            document.getElementById('modal').style.display = 'block';
            document.getElementById('overlay').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
            document.getElementById('overlay').style.display = 'none';
        }

        function renderCalendar() {
            const utcOffset = parseInt(document.getElementById('utcSelect').value);
            const body = document.getElementById('calendarBody');
            const label = document.getElementById('currentDateLabel');
            const months = ["Janvier", "Février", "Mars", "Avril", "Mai", "Juin", "Juillet", "Août", "Septembre", "Octobre", "Novembre", "Décembre"];

            label.innerText = months[currentMonth].toUpperCase() + " " + currentYear;
            body.innerHTML = '';

            let firstDay = new Date(currentYear, currentMonth, 1).getDay();
            let startingDay = (firstDay === 0) ? 6 : firstDay - 1;
            let daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

            let date = 1;
            for (let i = 0; i < 6; i++) {
                let row = document.createElement('tr');
                let hasCells = false;
                for (let j = 0; j < 7; j++) {
                    let cell = document.createElement('td');
                    if (i === 0 && j < startingDay || date > daysInMonth) {
                        cell.innerHTML = "";
                    } else {
                        hasCells = true;
                        let dateKey = String(date).padStart(2, '0') + "/" + String(currentMonth + 1).padStart(2, '0') + "/" + currentYear;
                        cell.innerHTML = `<div class="date-num">${date}</div>`;

                        if (data[dateKey]) {
                            data[dateKey].forEach(ev => {
                                let [h, m] = ev.heure.split(':').map(Number);
                                let localH = (h + utcOffset + 24) % 24;
                                let timeStr = String(localH).padStart(2, '0') + ":" + String(m).padStart(2, '0');

                                let div = document.createElement('div');
                                div.className = 'event';
                                div.innerText = timeStr + " " + ev.gp.split(' ')[0] + " - " + ev.titre;
                                div.onclick = (e) => {
                                    e.stopPropagation();
                                    showInfo(ev.gp, ev.titre, timeStr, ev.info);
                                };
                                cell.appendChild(div);
                            });
                        }
                        date++;
                    }
                    row.appendChild(cell);
                }
                if (hasCells) body.appendChild(row);
                if (date > daysInMonth) break;
            }
        }
        renderCalendar();
    </script>
</body>

</html>