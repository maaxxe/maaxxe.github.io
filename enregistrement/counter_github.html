<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compteur GitHub</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #2d7c4e 0%, #3fa561 100%);
            margin: 0;
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            text-align: center;
            max-width: 500px;
        }
        .counter {
            font-size: 4rem;
            font-weight: bold;
            color: #2d7c4e;
            margin: 20px 0;
            transition: all 0.3s ease;
        }
        button {
            padding: 15px 30px;
            font-size: 1.2rem;
            background: #2d7c4e;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: 0.3s;
            margin: 5px;
        }
        button:hover {
            background: #1f5a37;
            transform: translateY(-2px);
        }
        .btn-danger {
            background: #e74c3c;
        }
        .btn-danger:hover {
            background: #c0392b;
        }
        .btn-secondary {
            background: #5ec986;
        }
        .btn-secondary:hover {
            background: #4caf50;
        }
        .info {
            margin-top: 20px;
            padding: 15px;
            background: #f0f0f0;
            border-radius: 10px;
            text-align: left;
        }
        .info p {
            margin: 8px 0;
            color: #333;
        }
        .button-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1> Compteur de Clics</h1>
        <div class="counter" id="counter">0</div>
        <button onclick="trackClick()"> Cliquez-moi!</button>
        
        <div class="info">
            <p> Clics totaux: <strong id="total">0</strong></p>
            <p> IP: <strong id="ip">Chargement...</strong></p>
            <p> Lieu: <strong id="location">Chargement...</strong></p>
            <p> Appareil: <strong id="device">...</strong></p>
            <p> Navigateur: <strong id="browser">...</strong></p>
        </div>
        
        <div class="button-group">
            <button onclick="downloadData()"> Télécharger</button>
            <button onclick="viewData()" class="btn-secondary"> Voir données</button>

        </div>
                <div> <button onclick="resetCounter()" class="btn-danger"> Reset</button> </div>

    </div>

    <script>
        let sessionData = {
            clicks: [],
            sessionStart: new Date().toISOString(),
            totalClicks: 0
        };

        // Charger les données initiales
        loadInitialData();

        async function loadInitialData() {
            // Obtenir IP et localisation
            try {
                const ipRes = await fetch('https://api.ipify.org?format=json');
                const ipData = await ipRes.json();
                document.getElementById('ip').textContent = ipData.ip;
                
                const locRes = await fetch(`https://ipapi.co/${ipData.ip}/json/`);
                const locData = await locRes.json();
                document.getElementById('location').textContent = 
                    `${locData.city}, ${locData.country_name}`;
                
                sessionData.ip = ipData.ip;
                sessionData.location = `${locData.city}, ${locData.country_name}`;
            } catch (error) {
                console.error('Erreur IP:', error);
                document.getElementById('ip').textContent = 'Non disponible';
                document.getElementById('location').textContent = 'Non disponible';
            }

            // Détecter l'appareil
            const ua = navigator.userAgent;
            let device = 'Desktop';
            if (/mobile/i.test(ua)) device = 'Mobile';
            else if (/tablet/i.test(ua)) device = 'Tablet';
            document.getElementById('device').textContent = device;
            sessionData.device = device;

            // Détecter le navigateur
            const browser = getBrowser();
            document.getElementById('browser').textContent = browser;
            sessionData.browser = browser;

            // Charger depuis localStorage
            const saved = localStorage.getItem('clickData');
            if (saved) {
                sessionData = JSON.parse(saved);
                updateDisplay();
            }
        }

        async function trackClick() {
            sessionData.totalClicks++;
            
            const clickInfo = {
                id: sessionData.totalClicks,
                timestamp: new Date().toISOString(),
                ip: sessionData.ip || 'unknown',
                location: sessionData.location || 'unknown',
                device: sessionData.device || 'unknown',
                browser: sessionData.browser || 'unknown',
                screen: `${window.screen.width}x${window.screen.height}`
            };
            
            sessionData.clicks.push(clickInfo);
            
            // Sauvegarder localement
            localStorage.setItem('clickData', JSON.stringify(sessionData));
            
            // Envoyer à un service externe (optionnel)
            sendToWebhook(clickInfo);
            
            updateDisplay();
            animateCounter();
        }

        function updateDisplay() {
            document.getElementById('counter').textContent = sessionData.totalClicks;
            document.getElementById('total').textContent = sessionData.totalClicks;
        }

        function animateCounter() {
            const counter = document.getElementById('counter');
            counter.style.transform = 'scale(1.3)';
            counter.style.color = '#5ec986';
            setTimeout(() => {
                counter.style.transform = 'scale(1)';
                counter.style.color = '#2d7c4e';
            }, 300);
        }

        function getBrowser() {
            const ua = navigator.userAgent;
            if (ua.includes('Firefox')) return 'Firefox';
            if (ua.includes('Chrome')) return 'Chrome';
            if (ua.includes('Safari')) return 'Safari';
            if (ua.includes('Edge')) return 'Edge';
            return 'Unknown';
        }

        // RESET COMPTEUR
        function resetCounter() {
            if (confirm(' Réinitialiser toutes les données ?')) {
                // Réinitialiser les données
                sessionData = {
                    clicks: [],
                    sessionStart: new Date().toISOString(),
                    totalClicks: 0,
                    ip: sessionData.ip,
                    location: sessionData.location,
                    device: sessionData.device,
                    browser: sessionData.browser
                };
                
                // Supprimer du localStorage
                localStorage.removeItem('clickData');
                
                // Mettre à jour l'affichage
                updateDisplay();
                
                // Animation
                const counter = document.getElementById('counter');
                counter.style.transform = 'scale(0.8)';
                counter.style.color = '#e74c3c';
                setTimeout(() => {
                    counter.style.transform = 'scale(1)';
                    counter.style.color = '#2d7c4e';
                }, 300);
                
                alert(' Compteur réinitialisé !');
            }
        }

        // Envoyer à un webhook (Discord, Slack, etc.)
        async function sendToWebhook(data) {
            // REMPLACE CETTE URL par ton webhook Discord/Slack
            const webhookURL = 'YOUR_WEBHOOK_URL_HERE';
            
            try {
                await fetch(webhookURL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        content: ` Nouveau clic #${data.id}`,
                        embeds: [{
                            title: 'Détails du clic',
                            color: 3066993,
                            fields: [
                                { name: 'IP', value: data.ip, inline: true },
                                { name: 'Lieu', value: data.location, inline: true },
                                { name: 'Appareil', value: data.device, inline: true },
                                { name: 'Navigateur', value: data.browser, inline: true },
                                { name: 'Heure', value: new Date(data.timestamp).toLocaleString('fr-FR') }
                            ]
                        }]
                    })
                });
            } catch (error) {
                console.log('Webhook non configuré');
            }
        }

        function downloadData() {
            const dataStr = JSON.stringify(sessionData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `clicks_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function viewData() {
            const dataWindow = window.open('', '_blank', 'width=900,height=700');
            dataWindow.document.write(`
                <html>
                <head>
                    <title> Données de clics</title>
                    <style>
                        body { 
                            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
                            padding: 30px; 
                            background: #1e1e1e; 
                            color: #d4d4d4; 
                        }
                        h2 { color: #5ec986; }
                        .stats {
                            background: #2d2d2d;
                            padding: 20px;
                            border-radius: 10px;
                            margin-bottom: 20px;
                        }
                        .stat-item {
                            display: flex;
                            justify-content: space-between;
                            margin: 10px 0;
                            padding: 10px;
                            background: #3d3d3d;
                            border-radius: 5px;
                        }
                        pre { 
                            background: #2d2d2d; 
                            padding: 20px; 
                            border-radius: 10px; 
                            overflow: auto;
                            font-size: 14px;
                            line-height: 1.5;
                        }
                    </style>
                </head>
                <body>
                    <h2> Statistiques des clics</h2>
                    <div class="stats">
                        <div class="stat-item">
                            <strong>Total de clics:</strong>
                            <span>${sessionData.totalClicks}</span>
                        </div>
                        <div class="stat-item">
                            <strong>Session démarrée:</strong>
                            <span>${new Date(sessionData.sessionStart).toLocaleString('fr-FR')}</span>
                        </div>
                        <div class="stat-item">
                            <strong>IP:</strong>
                            <span>${sessionData.ip}</span>
                        </div>
                        <div class="stat-item">
                            <strong>Localisation:</strong>
                            <span>${sessionData.location}</span>
                        </div>
                    </div>
                    
                    <h2> Détails complets (JSON)</h2>
                    <pre>${JSON.stringify(sessionData, null, 2)}</pre>
                </body>
                </html>
            `);
        }
    </script>
</body>
</html>
